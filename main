<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Asana ìë™ íŒŒì‹± ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f8f9fa; padding: 30px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { color: #444; font-size: 1.2rem; margin-bottom: 20px; border-left: 4px solid #007bff; padding-left: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ“Š ì œì‘ ìš”ì²­ ì‹¤ì‹œê°„ íŠ¸ë˜í‚¹</h1>
    
    <div class="grid">
        <div class="card">
            <h2>ğŸ“… ì¼ìë³„ ìš”ì²­ ê±´ìˆ˜ (íƒœìŠ¤í¬ ê¸°ë°˜)</h2>
            <canvas id="dailyChart"></canvas>
        </div>
        <div class="card">
            <h2>ğŸ·ï¸ ìº í˜ì¸ë³„ ì œì‘ ë¹„ì¤‘</h2>
            <canvas id="campaignChart"></canvas>
        </div>
    </div>

<script>
// --- ì•„ì‚¬ë‚˜ ì„¤ì • ---
const ASANA_PAT = '
';
const PROJECT_ID = ';

async function loadDashboard() {
    const response = await fetch(`https://app.asana.com/api/1.0/projects/${PROJECT_ID}/tasks?opt_fields=name`, {
        headers: { 'Authorization': `Bearer ${ASANA_PAT}` }
    });
    const { data } = await response.json();
    
    const dailyStats = {};   // { '2026-02-24': 5, ... }
    const campaignStats = {}; // { 'ì˜¬ì˜ê¸€ë¡œë²Œ': 10, 'ì½”ì˜¤ë¡±ëª°': 8, ... }

    data.forEach(task => {
        const name = task.name;
        // 1. ì´ë¦„ì—ì„œ ë‚ ì§œ ì¶”ì¶œ (ì• 6ìë¦¬)
        const dateRaw = name.substring(0, 6); 
        if (!/^\d{6}$/.test(dateRaw)) return; // ìˆ«ìê°€ ì•„ë‹ˆë©´ íŒ¨ìŠ¤

        const formattedDate = `20${dateRaw.substring(0,2)}-${dateRaw.substring(2,4)}-${dateRaw.substring(4,6)}`;
        
        // 2. ì´ë¦„ì—ì„œ ìº í˜ì¸ëª… ì¶”ì¶œ (ì–¸ë”ë°” ì‚¬ì´ ë‹¨ì–´)
        const parts = name.split('_');
        const campaign = parts[1] || 'ê¸°íƒ€';

        // 3. í†µê³„ í•©ì‚°
        dailyStats[formattedDate] = (dailyStats[formattedDate] || 0) + 1;
        campaignStats[campaign] = (campaignStats[campaign] || 0) + 1;
    });

    renderCharts(dailyStats, campaignStats);
}

function renderCharts(daily, campaign) {
    // ì¼ìë³„ ì„  ê·¸ë˜í”„
    const dates = Object.keys(daily).sort();
    new Chart(document.getElementById('dailyChart'), {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{ label: 'ìš”ì²­ ê±´ìˆ˜', data: dates.map(d => daily[d]), borderColor: '#007bff', tension: 0.3, fill: true, backgroundColor: 'rgba(0,123,255,0.1)' }]
        }
    });

    // ìº í˜ì¸ë³„ íŒŒì´ ì°¨íŠ¸
    new Chart(document.getElementById('campaignChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(campaign),
            datasets: [{ data: Object.values(campaign), backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'] }]
        }
    });
}

loadDashboard();
</script>
</body>
</html>
